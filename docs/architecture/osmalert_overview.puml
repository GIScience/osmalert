@startuml
!include <logos/kafka>

title "Osmalert Architectural Overview"

skinparam linetype ortho


<style>
    queue {
      BackGroundColor #lightblue
    }

    component {
      BackGroundColor #beige
      LineColor black
    }
</style>

queue "<$kafka>" as kafka


'component "OSM Planet Server" as osm <<External Server>> #lightgray
'component "OhsomeNow OSHDB" as updater <<Streaming Producer>>
'component "OhsomeNow Processing" as processing <<Streaming Component>>

folder "Osmalert Webapp" <<Heroku Component>> {

    database  "Jobs Database" as jobsdb

    component "Webapp" as bootapp <<Spring Boot>>

    bootapp -> jobsdb


}

folder "Flink Cluster" <<Heroku Component>> {

    component "Alert Job 1" as job1 <<Flink Job>>
    component "Alert Job 2" as job2 <<Flink Job>>
    component "Alert Job N" as job3 <<Flink Job>>


    kafka --> job1
    kafka --> job2 : OSM contributions
    kafka --> job3

}


'osm --> updater : minute-diffs
'updater --> kafka : raw contributions

'oshdb -> updater
'updater -> oshdb

'osm --> processing : changesets
'kafka --> processing : raw contributions
'processing --> kafka : located contributions
'kafka ---> appbackend : located contributions


@enduml